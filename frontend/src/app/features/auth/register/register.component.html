<div class="animated-bg"></div>

<div class="auth-container-center">
  <div class="auth-card-container">
    <div class="auth-right-panel">
      <div class="auth-form-container">

        <div class="auth-header">
          <div class="auth-logo">
            <i class="bi bi-person-plus"></i>
          </div>
          <h2 class="auth-title">Créer un compte</h2>
          <p class="auth-subtitle">Rejoignez-nous et commencez votre aventure musicale</p>
        </div>

        @if(loading) {
          <div class="d-flex justify-content-center align-items-center my-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Envoi en cours...</span>
            </div>
            <span class="ms-3">Envoi de l'email de confirmation...</span>
          </div>
        }

        @if(err && !loading) {
          <div class="alert alert-danger" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>{{ err }}</strong>
          </div>
        }
        <form [formGroup]="myForm" (ngSubmit)="onRegister()">
          <div class="form-group">
            <label class="form-label">
              <i class="bi bi-person"></i>
              Nom d'utilisateur
            </label>
            <div class="input-group-custom">
              <i class="input-icon bi bi-person"></i>
              <input
                type="text"
                name="username"
                class="form-control-custom"
                placeholder="Votre nom d'utilisateur"
                formControlName="username"
                [(ngModel)]="user.username"
                [class.is-invalid]="isFieldInvalid('username')"
                required>
            </div>
            @if(isFieldInvalid('username')) {
              <small class="text-danger">
                <i class="bi bi-exclamation-circle"></i> {{ getFieldError('username') }}
              </small>
            }
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="bi bi-envelope"></i>
              Adresse email
            </label>
            <div class="input-group-custom">
              <i class="input-icon bi bi-envelope"></i>
              <input
                type="email"
                name="email"
                class="form-control-custom"
                placeholder="exemple@email.com"
                formControlName="email"
                [(ngModel)]="user.email"
                [class.is-invalid]="isFieldInvalid('email')"
                required>
            </div>
            @if(isFieldInvalid('email')) {
              <small class="text-danger">
                <i class="bi bi-exclamation-circle"></i> {{ getFieldError('email') }}
              </small>
            }
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="bi bi-lock"></i>
              Mot de passe
            </label>
            <div class="input-group-custom">
              <i class="input-icon bi bi-lock"></i>
              <input
                type="password"
                name="password"
                class="form-control-custom"
                placeholder="••••••••"
                id="registerPassword"
                formControlName="password"
                [(ngModel)]="user.password"
                [class.is-invalid]="isFieldInvalid('password')"
                required>
              <button type="button" class="password-toggle" (click)="togglePassword('registerPassword')">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            @if(isFieldInvalid('password')) {
              <small class="text-danger">
                <i class="bi bi-exclamation-circle"></i> {{ getFieldError('password') }}
              </small>
            }
          </div>
          <div class="form-group">
            <label class="form-label">
              <i class="bi bi-lock-fill"></i>
              Confirmer le mot de passe
            </label>
            <div class="input-group-custom">
              <i class="input-icon bi bi-lock-fill"></i>
              <input
                type="password"
                name="confirmPassword"
                class="form-control-custom"
                placeholder="••••••••"
                id="confirmPassword"
                formControlName="confirmPassword"
                [class.is-invalid]="isFieldInvalid('confirmPassword') || myForm.hasError('passwordMismatch')"
                required>
              <button type="button" class="password-toggle" (click)="togglePassword('confirmPassword')">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            @if(isFieldInvalid('confirmPassword')) {
              <small class="text-danger">
                <i class="bi bi-exclamation-circle"></i> {{ getFieldError('confirmPassword') }}
              </small>
            }
            @if(myForm.hasError('passwordMismatch') && myForm.get('confirmPassword')?.touched) {
              <small class="text-danger">
                <i class="bi bi-exclamation-circle"></i> Les mots de passe ne correspondent pas
              </small>
            }
          </div>

          <button
            type="submit"
            class="btn-primary-custom"
            [disabled]="loading">
            @if(loading) {
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Inscription en cours...
            } @else {
              <i class="bi bi-person-check"></i>
              Créer mon compte
            }
          </button>
        </form>

        <div class="auth-link">
          Vous avez déjà un compte ?
          <a routerLink="/login">Se connecter</a>
        </div>
      </div>
    </div>
  </div>
</div>
